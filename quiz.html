<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Bierbike Quiz ‚Äì Spieler</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: sans-serif; margin:10px; }
  h1,h2,h3 { margin:5px 0; text-align:center; }
  #timer { font-size:2em; font-weight:bold; margin-bottom:15px; text-align:center; }
  .category { font-weight:bold; color:white; padding:8px; border-radius:5px; margin-bottom:5px; text-align:center; }
  .questionWrapper { display:flex; justify-content: space-between; align-items:center; margin-bottom:10px; flex-wrap: wrap; }
  #questionText { flex:1; font-size:1.2em; margin-bottom:5px; }
  #pointsCircle { width:60px; height:60px; border-radius:50%; background:#ddd; text-align:center; line-height:1.2; font-weight:bold; margin-left:10px; }
  hr { border:1px solid #ccc; margin:5px 0 10px 0; }
  #options div { margin:5px 0; padding:12px; border:1px solid #333; cursor:pointer; border-radius:5px; font-size:1.1em; text-align:center; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>Bierbike Quiz</h1>

<div id="name-team">
  <input type="text" id="playerName" placeholder="Dein Name" style="width:100%; padding:8px; font-size:1em;">
  <select id="teamSelect" style="width:100%; padding:8px; margin-top:5px; font-size:1em;">
    <option value="rot">Rot</option>
    <option value="blau">Blau</option>
  </select>
  <button id="joinBtn" style="width:100%; padding:10px; margin-top:5px; font-size:1.1em;">Beitreten</button>
</div>

<div id="quizArea" style="display:none;">
  <div id="timer">15</div>
  <div id="categoryTitle" class="category" style="background:#f88">Kategorie</div>
  <hr>
  <div class="questionWrapper">
    <div id="questionText">Frage</div>
    <div id="pointsCircle"><span id="pointsNumber">1</span><br>Punkte</div>
  </div>
  <div id="options"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDS2CTzFC_G-dTi-LE5umuvTWET4plsGH0",
  authDomain: "as-fensterbau-baf6c.firebaseapp.com",
  projectId: "as-fensterbau-baf6c",
  storageBucket: "as-fensterbau-baf6c.firebasestorage.app",
  messagingSenderId: "25696521871",
  appId: "1:25696521871:web:35cca5b0e39f88c4576afa"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const playersCol = db.collection('players');
const gameState = db.collection('game').doc('state');

let currentQ = 0;
let timerInterval;

// Beispiel-Fragen
let questions = [
  {category:"Allgemeinwissen", question:"Frage 1?", points:1, options:["A","B","C","D"], answer:0},
  {category:"Allgemeinwissen", question:"Frage 2?", points:2, options:["A","B","C","D"], answer:1},
  {category:"Allgemeinwissen", question:"Frage 3?", points:3, options:["A","B","C","D"], answer:2},
  {category:"Allgemeinwissen", question:"Frage 4?", points:4, options:["A","B","C","D"], answer:3},
  {category:"Allgemeinwissen", question:"Frage 5?", points:5, options:["A","B","C","D"], answer:0},
];

// Spieler beitreten
document.getElementById('joinBtn').addEventListener('click', ()=>{
  const name = document.getElementById('playerName').value;
  const team = document.getElementById('teamSelect').value;
  if(!name) return alert("Bitte Name eingeben!");
  playersCol.add({name, team, score:0}).then(()=>{
    document.getElementById('name-team').style.display='none';
    document.getElementById('quizArea').style.display='block';
  });
});

// Quiz startet erst nach Admin Start
gameState.onSnapshot(doc=>{
  const data = doc.data();
  if(data?.started) showQuestion(currentQ);
});

function showQuestion(index){
  if(index >= questions.length){
    document.getElementById('quizArea').innerHTML="<h2>Yoo Digga, Feierabend! Danke f√ºr's mitmachen üç∫</h2>";
    return;
  }
  const q = questions[index];
  document.getElementById('categoryTitle').textContent = q.category;
  document.getElementById('questionText').textContent = q.question;
  document.getElementById('pointsNumber').textContent = q.points;

  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.textContent=opt;
    div.addEventListener('click', async ()=>{
      const playerName = document.getElementById('playerName').value;
      const snapshot = await playersCol.where('name','==',playerName).get();
      if(!snapshot.empty){
        const docRef = snapshot.docs[0];
        const playerData = docRef.data();
        if(i===q.answer){
          const newScore = (playerData.score||0)+q.points;
          docRef.ref.update({score:newScore});
        }
      }
      currentQ++;
      showQuestion(currentQ);
    });
    optionsDiv.appendChild(div);
  });

  // Timer pro Frage
  let time=15;
  document.getElementById('timer').textContent=time;
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    time--;
    document.getElementById('timer').textContent=time;
    if(time<=0){ clearInterval(timerInterval); currentQ++; showQuestion(currentQ);}
  },1000);
}
</script>
</body>
</html>
