<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Bierbike Quiz ‚Äì Spieler</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: sans-serif;
}
body {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  background: #fafafa;
}
#name-team {
  width: 90%;
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
#quizArea {
  width: 100%;
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  align-items: center;
  padding: 10px;
}
#timer {
  font-size: 2em;
  font-weight: bold;
  margin-top: 10px;
}
.category {
  font-weight: bold;
  color: white;
  padding: 10px;
  border-radius: 5px;
  text-align: center;
  width: 90%;
}
.questionWrapper {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 90%;
}
#questionText {
  font-size: 1.2em;
  text-align: center;
  flex: 1;
}
#pointsCircle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background:#ddd;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  margin-left:10px;
  text-align:center;
  flex-shrink:0;
}
#options {
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: 90%;
}
#options div {
  padding: 15px;
  font-size: 1.2em;
  border-radius: 8px;
  text-align: center;
  background: #eee;
  cursor: pointer;
  user-select: none;
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div id="name-team">
  <input type="text" id="playerName" placeholder="Dein Name">
  <select id="teamSelect">
    <option value="rot">Rot</option>
    <option value="blau">Blau</option>
  </select>
  <button id="joinBtn">Beitreten</button>
</div>

<div id="quizArea" style="display:none;">
  <div id="timer">15</div>
  <div id="categoryTitle" class="category" style="background:#f88">Kategorie</div>
  <hr style="width:90%; border:1px solid #ccc;">
  <div class="questionWrapper">
    <div id="questionText">Frage</div>
    <div id="pointsCircle"><span id="pointsNumber">1</span><br>Punkte</div>
  </div>
  <div id="options"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDS2CTzFC_G-dTi-LE5umuvTWET4plsGH0",
  authDomain: "as-fensterbau-baf6c.firebaseapp.com",
  projectId: "as-fensterbau-baf6c",
  storageBucket: "as-fensterbau-baf6c.firebasestorage.app",
  messagingSenderId: "25696521871",
  appId: "1:25696521871:web:35cca5b0e39f88c4576afa"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const playersCol = db.collection('players');
const gameState = db.collection('game').doc('state');

let currentQ = 0;
let timerInterval;

let questions = [
  {category:"Allgemeinwissen", question:"Frage 1?", points:1, options:["A","B","C","D"], answer:0},
  {category:"Allgemeinwissen", question:"Frage 2?", points:2, options:["A","B","C","D"], answer:1},
  {category:"Allgemeinwissen", question:"Frage 3?", points:3, options:["A","B","C","D"], answer:2},
  {category:"Allgemeinwissen", question:"Frage 4?", points:4, options:["A","B","C","D"], answer:3},
  {category:"Allgemeinwissen", question:"Frage 5?", points:5, options:["A","B","C","D"], answer:0},
];

// Spieler beitreten
document.getElementById('joinBtn').addEventListener('click', ()=>{
  const name = document.getElementById('playerName').value.trim();
  const team = document.getElementById('teamSelect').value;
  if(!name) return alert("Bitte Name eingeben!");
  playersCol.add({name, team, score:0}).then(()=>{
    document.getElementById('name-team').style.display='none';
    document.getElementById('quizArea').style.display='flex';
  });
});

// Quiz startet erst nach Admin Start
gameState.onSnapshot(doc=>{
  const data = doc.data();
  if(data?.started) showQuestion(currentQ);
});

function showQuestion(index){
  if(index >= questions.length){
    document.getElementById('quizArea').innerHTML="<h2>Feierabend, ihr Legenden! üç∫</h2>";
    return;
  }
  const q = questions[index];
  document.getElementById('categoryTitle').textContent = q.category;
  document.getElementById('questionText').textContent = q.question;
  document.getElementById('pointsNumber').textContent = q.points;

  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML='';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.textContent=opt;
    div.addEventListener('click', async ()=>{
      const playerName = document.getElementById('playerName').value;
      const snapshot = await playersCol.where('name','==',playerName).get();
      if(!snapshot.empty){
        const docRef = snapshot.docs[0];
        const playerData = docRef.data();
        if(i===q.answer){
          const newScore = (playerData.score||0)+q.points;
          docRef.ref.update({score:newScore});
        }
      }
      currentQ++;
      showQuestion(currentQ);
    });
    optionsDiv.appendChild(div);
  });

  let time=15;
  document.getElementById('timer').textContent=time;
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    time--;
    document.getElementById('timer').textContent=time;
    if(time<=0){ clearInterval(timerInterval); currentQ++; showQuestion(currentQ);}
  },1000);
}
</script>
</body>
</html>
