<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Bierbike-Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body {
    margin:0;
    font-family:sans-serif;
    background:#f4f4f4;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    position:relative;
}
#joinArea, #waitingArea, #quizArea {
    width:90%;
    max-width:500px;
    text-align:center;
}
h1 {
    margin-bottom:20px;
}
input, button {
    width:100%;
    padding:12px;
    font-size:1.1em;
    margin:8px 0;
    border-radius:8px;
    border:1px solid #ccc;
    box-sizing:border-box;
}
.teamSelect {
    display:flex;
    justify-content:space-around;
    margin:15px 0;
}
.teamBtn {
    flex:1;
    margin:0 5px;
    padding:15px;
    border-radius:10px;
    font-size:1.1em;
    cursor:pointer;
    border:none;
    color:white;
}
.red {
    background:#d9534f;
}
.blue {
    background:#0275d8;
}
.inactive {
    opacity:0.4;
}
.selected {
    border:3px solid #000;
    filter:brightness(1.2);
}
#waitingArea img {
    max-width:200px;
    margin-top:40px;
}
#questionHeader {
    background:#b2ebf2;
    padding:10px;
    border-radius:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:10px;
}
#playerScore {
    font-size:1.2em;
    margin-bottom:10px;
    position:relative;
}
#timer {
    font-size:1.5em;
    margin:10px 0;
    font-weight:bold;
}
.answerBtn {
    width:100%;
    min-height:60px;
    margin:8px 0;
    font-size:1em;
    border-radius:8px;
    border:1px solid #aaa;
    cursor:pointer;
    background:#fff;
    transition:background 0.3s, transform 0.3s;
}
.answerBtn.correct {
    background-color:#a2d5a2;
}
.answerBtn.wrong {
    background-color:#f4a2a2;
}
#countdownOverlay {
    position:fixed;
    top:20%;
    left:0;
    width:100%;
    height:60px;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:3em;
    display:none;
    z-index:1000;
    transition: color 0.5s ease;
}
#progress {
    position:fixed;
    bottom:10px;
    width:100%;
    text-align:center;
    font-size:1.1em;
    font-weight:normal;
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="joinArea">
    <img id="logo" src="Bilder/logo_lightmode.png" alt="Logo" style="max-width:150px;margin-bottom:20px;">
    <h1>Bierbike-Quiz</h1>
    <input id="playerName" type="text" placeholder="Dein Name (max 10 Zeichen)">
    <div class="teamSelect">
        <button id="redBtn" class="teamBtn red">Rotes Team</button>
        <button id="blueBtn" class="teamBtn blue">Blaues Team</button>
    </div>
    <button id="joinBtn">Enter</button>
</div>
<div id="waitingArea" style="display:none;">
    <img id="waitingLogo" src="Bilder/logo_lightmode.png" alt="Logo">
    <p id="waitingMessage">Bitte warten, der Admin startet das Spiel‚Ä¶</p>
</div>
<div id="quizArea" style="display:none;">
    <div id="playerScore">Punkte: 0</div>
    <div id="questionHeader">
        <div id="categoryName">Kategorie</div>
        <div id="questionPoints">1 Punkt</div>
    </div>
    <div id="timer">15</div>
    <div id="questionText">Frage erscheint hier‚Ä¶</div>
    <div id="answers"></div>
</div>
<div id="countdownOverlay">5</div>
<div id="progress"></div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDS2CTzFC_G-dTi-LE5umuvTWET4plsGH0",
    authDomain: "as-fensterbau-baf6c.firebaseapp.com",
    projectId: "as-fensterbau-baf6c",
    storageBucket: "as-fensterbau-baf6c.firebasestorage.app",
    messagingSenderId: "25696521871",
    appId: "1:25696521871:web:35cca5b0e39f88c4576afa"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const playersCol = db.collection("players");
const gameState = db.collection("game").doc("state");

let selectedTeam = null;
let currentPlayerId = null;
let score = 0;
let currentQuestionSet = 0;
let currentQuestionIndex = 0;
let questionTimer;
const questionDuration = 15;

// Darkmode
if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
    document.getElementById("logo").src="Bilder/logo_darkmode.png";
    document.getElementById("waitingLogo").src="Bilder/logo_darkmode.png";
}

// üîπ Warnung beim Neuladen/Schlie√üen
window.addEventListener("beforeunload", (event) => {
    if(currentPlayerId){
        event.preventDefault();
        event.returnValue = "Wenn du die Seite verl√§sst, verlierst du deinen Platz im Spiel. Bist du sicher, dass du neuladen willst?";
    }
});

// Team-Auswahl
document.getElementById("redBtn").addEventListener("click", ()=>selectTeam("rot"));
document.getElementById("blueBtn").addEventListener("click", ()=>selectTeam("blau"));

function selectTeam(team){
    selectedTeam=team;
    document.getElementById("redBtn").classList.remove("selected","inactive");
    document.getElementById("blueBtn").classList.remove("selected","inactive");
    if(team==="rot"){
        document.getElementById("redBtn").classList.add("selected");
        document.getElementById("blueBtn").classList.add("inactive");
    } else {
        document.getElementById("blueBtn").classList.add("selected");
        document.getElementById("redBtn").classList.add("inactive");
    }
}

// Fragen und Kategorien
let questionCategories=[
    { category:"Geografie", questions:[
        {text:"Welche Stadt ist die Hauptstadt von Frankreich?", answers:[{text:"Rom",correct:false},{text:"Berlin",correct:false},{text:"Paris",correct:true},{text:"Madrid",correct:false}]},
        {text:"Welches Land ist fl√§chenm√§√üig das gr√∂√üte der Erde?", answers:[{text:"Kanada",correct:false},{text:"Russland",correct:true},{text:"USA",correct:false},{text:"China",correct:false}]},
        {text:"Welcher Fluss flie√üt durch Budapest?", answers:[{text:"Rhein",correct:false},{text:"Elbe",correct:false},{text:"Donau",correct:true},{text:"Po",correct:false}]},
        {text:"Welches Land hat keine K√ºste?", answers:[{text:"Bolivien",correct:true},{text:"Peru",correct:false},{text:"Kroatien",correct:false},{text:"Thailand",correct:false}]},
        {text:"In welchem Land liegt der h√∂chste aktive Vulkan der Erde, der Ojos del Salado?", answers:[{text:"Chile",correct:true},{text:"Indonesien",correct:false},{text:"Italien",correct:false},{text:"√Ñthiopien",correct:false}]}
    ]},
    { category:"Geschichte", questions:[
        {text:"Wer war der erste Bundeskanzler der BRD?", answers:[{text:"Willy Brandt",correct:false},{text:"Gerhard Schr√∂der",correct:false},{text:"Konrad Adenauer",correct:true},{text:"Helmut Kohl",correct:false}]},
        {text:"In welchem Jahr fiel die Berliner Mauer?", answers:[{text:"1981",correct:false},{text:"1985",correct:false},{text:"1989",correct:true},{text:"1991",correct:false}]},
        {text:"Wer f√ºhrte den Zug √ºber die Alpen mit Elefanten?", answers:[{text:"Caesar",correct:false},{text:"Alexander der Gro√üe",correct:false},{text:"Hannibal",correct:true},{text:"Napoleon",correct:false}]},
        {text:"Welcher Krieg endete mit dem Westf√§lischen Frieden 1648?", answers:[{text:"Erster Weltkrieg",correct:false},{text:"Drei√üigj√§hriger Krieg",correct:true},{text:"Hundertj√§hriger Krieg",correct:false},{text:"Spanischer Erbfolgekrieg",correct:false}]},
        {text:"Welches Jahr markiert den Beginn der Franz√∂sischen Revolution?", answers:[{text:"1776",correct:false},{text:"1804",correct:false},{text:"1789",correct:true},{text:"1812",correct:false}]}
    ]},
	{ category:"Natur & Wissenschaft", questions:[
		{text:"Welcher Planet wird als \"Roter Planet\" bezeichnet?", answers:[{text:"Venus", correct:false},{text:"Merkur", correct:false},{text:"Mars", correct:true},{text:"Jupiter", correct:false}]},
		{text:"Wie viele Z√§hne hat ein erwachsener Mensch normalerweise?", answers:[{text:"28", correct:false},{text:"32", correct:true},{text:"30", correct:false},{text:"36", correct:false}]},
		{text:"Welches chemische Element hat das Symbol ‚ÄûO‚Äú?", answers:[{text:"Gold", correct:false},{text:"Sauerstoff", correct:true},{text:"Zink", correct:false},{text:"Kalium", correct:false}]},
		{text:"Welche Blutgruppe gilt als ‚ÄûUniversalspender‚Äú?", answers:[{text:"A-", correct:false},{text:"0-", correct:true},{text:"AB+", correct:false},{text:"B+", correct:false}]},
		{text:"Wie hei√üt der Prozess, bei dem Pflanzen mit Sonnenlicht Energie herstellen?", answers:[{text:"Fermentation", correct:false},{text:"Photosynthese", correct:true},{text:"Respiration", correct:false},{text:"Osmose", correct:false}]}
	]},
	{ category:"Sport", questions:[
		{text:"Wie viele Spieler stehen bei einer Fu√üballmannschaft auf dem Feld?", answers:[{text:"10", correct:false},{text:"12", correct:false},{text:"11", correct:true},{text:"9", correct:false}]},
		{text:"In welcher Sportart gewann Michael Schumacher Weltmeistertitel?", answers:[{text:"Tennis", correct:false},{text:"Radsport", correct:false},{text:"Formel 1", correct:true},{text:"Ski Alpin", correct:false}]},
		{text:"Wo fanden die Olympischen Sommerspiele 2008 statt?", answers:[{text:"Athen", correct:false},{text:"London", correct:false},{text:"Peking", correct:true},{text:"Sydney", correct:false}]},
		{text:"Welcher Tennisspieler hat die meisten Grand-Slam-Titel gewonnen (Stand 2023)?", answers:[
        {text:"Roger Federer", correct:false},{text:"Novak Djokovic", correct:true},{text:"Rafael Nadal", correct:false},{text:"Pete Sampras", correct:false}]},
		{text:"Welcher Sportler wurde ‚ÄûThe Greatest‚Äú genannt?", answers:[{text:"Pel√©", correct:false},{text:"Muhammad Ali", correct:true},{text:"Usain Bolt", correct:false},{text:"Michael Jordan", correct:false}]}
]},
	{ category:"Kunst & Kultur", questions:[
		{text:"Wer malte die ‚ÄûMona Lisa‚Äú?", answers:[{text:"Picasso", correct:false},{text:"Leonardo da Vinci", correct:true},{text:"Rembrandt", correct:false},{text:"Van Gogh", correct:false}]},
		{text:"Welcher Komponist war im Alter von 5 Jahren ein Wunderkind am Klavier?", answers:[{text:"Beethoven", correct:false},{text:"Mozart", correct:true},{text:"Haydn", correct:false},{text:"Chopin", correct:false}]},
		{text:"Welches Land gilt als Ursprungsort des Tango?", answers:[{text:"Spanien", correct:false},{text:"Italien", correct:false},{text:"Argentinien", correct:true},{text:"Frankreich", correct:false}]},
		{text:"Wer schrieb das Theaterst√ºck ‚ÄûFaust‚Äú?", answers:[{text:"Goethe", correct:true},{text:"Schiller", correct:false},{text:"Lessing", correct:false},{text:"Brecht", correct:false}]},
		{text:"Welcher Maler schnitt sich ein Ohr ab?", answers:[{text:"Monet", correct:false},{text:"Van Gogh", correct:true},{text:"C√©zanne", correct:false},{text:"Gauguin", correct:false}]}
]},
	{ category:"Technik & Erfindungen", questions:[
		{text:"Wer erfand die Gl√ºhbirne?", answers:[{text:"Nikola Tesla", correct:false},{text:"Alexander Graham Bell", correct:false},{text:"Thomas Edison", correct:true},{text:"James Watt", correct:false}]},
		{text:"Welches Unternehmen stellte 1976 den ersten Apple-Computer her?", answers:[{text:"Microsoft", correct:false},{text:"IBM", correct:false},{text:"Apple", correct:true},{text:"Hewlett-Packard", correct:false}]},
		{text:"Wie nennt man die kleinste speicherbare Informationseinheit in der Informatik?", answers:[{text:"Byte", correct:false},{text:"Bit", correct:true},{text:"Kilobyte", correct:false},{text:"Megabyte", correct:false}]},
		{text:"Wer entwickelte die Relativit√§tstheorie?", answers:[{text:"Isaac Newton", correct:false},{text:"Nikola Tesla", correct:false},{text:"Galileo Galilei", correct:false},{text:"Albert Einstein", correct:true}]},
		{text:"Welches Material wird in der Mikrochip-Produktion haupts√§chlich verwendet?", answers:[{text:"Eisen", correct:false},{text:"Silizium", correct:true},{text:"Aluminium", correct:false},{text:"Kupfer", correct:false}]}
]},
	{ category:"Essen & Trinken", questions:[
		{text:"Aus welchem Land stammt Pizza urspr√ºnglich?", answers:[{text:"Frankreich", correct:false},{text:"Deutschland", correct:false},{text:"Italien", correct:true},{text:"USA", correct:false}]},
		{text:"Was ist die Hauptzutat von Hummus?", answers:[{text:"Linsen", correct:false},{text:"Kichererbsen", correct:true},{text:"Erbsen", correct:false},{text:"Bohnen", correct:false}]},
		{text:"Welcher K√§se ist traditionell f√ºr Pizza Margherita gedacht?", answers:[{text:"Gouda", correct:false},{text:"Cheddar", correct:false},{text:"Mozzarella", correct:true},{text:"Emmentaler", correct:false}]},
		{text:"Wie nennt man die alkoholische G√§rung von Traubensaft?", answers:[{text:"Destillation", correct:false},{text:"Filtration", correct:false},{text:"Weinbereitung", correct:true},{text:"Lagerung", correct:false}]},
		{text:"Welches Gew√ºrz gibt Curry seine typische gelbe Farbe?", answers:[{text:"Safran", correct:false},{text:"Paprika", correct:false},{text:"Kurkuma", correct:true},{text:"Kardamom", correct:false}]}
]},
	{ category:"Medien & Unterhaltung", questions:[
		{text:"Wer ist der Regisseur von ‚ÄûJurassic Park‚Äú?", answers:[{text:"James Cameron", correct:false},{text:"Steven Spielberg", correct:true},{text:"George Lucas", correct:false},{text:"Tim Burton", correct:false}]},
		{text:"Wie hei√üt der ber√ºhmte Zauberlehrling in J.K. Rowlings B√ºchern?", answers:[{text:"Frodo", correct:false},{text:"Harry Potter", correct:true},{text:"Percy Jackson", correct:false},{text:"Aragorn", correct:false}]},
		{text:"Welcher Film gewann 2020 den Oscar f√ºr den besten Film?", answers:[{text:"1917", correct:false},{text:"Parasite", correct:true},{text:"Joker", correct:false},{text:"Once Upon a Time in Hollywood", correct:false}]},
		{text:"In welcher TV-Serie gibt es die Figur ‚ÄûWalter White‚Äú?", answers:[{text:"Game of Thrones", correct:false},{text:"Stranger Things", correct:false},{text:"Breaking Bad", correct:true},{text:"The Wire", correct:false}]},
		{text:"Wer sang den Song ‚ÄûThriller‚Äú?", answers:[{text:"Prince", correct:false},{text:"Madonna", correct:false},{text:"Elton John", correct:false},{text:"Michael Jackson", correct:true}]}
]},
	{ category:"AS Fensterbau GmbH", questions:[
		{text:"In welcher Stra√üe ist die Firma ans√§ssig?", answers:[{text:"Wierlings Esch 3", correct:false},{text:"Wierling Esch 5", correct:false},{text:"Wierlings Busch 3", correct:true},{text:"Wierlings Busch 5", correct:false}]},
		{text:"Wie viele Mitarbeiter sitzen im B√ºro?   (Chef ausgenommen)", answers:[{text:"F√ºnf", correct:false},{text:"Sieben", correct:true},{text:"Sechs", correct:false},{text:"Acht", correct:false}]},
		{text:"Welche Schriftfarbe hat das Logo der Firma?", answers:[{text:"Blau", correct:true},{text:"Schwarz", correct:false},{text:"Wei√ü", correct:false},{text:"Grau", correct:false}]},
		{text:"Welche dieser Folien wir bei Fenstern aktuell am meisten verkauft?", answers:[{text:"Schwarz genarbt", correct:false},{text:"Alux Graualuminium", correct:true},{text:"Wei√ü", correct:false},{text:"Grau genarbt", correct:false}]},
		{text:"Wie viele Kammern hat das Standard-Fensterprofil?", answers:[{text:"Vier", correct:false},{text:"F√ºnf", correct:false},{text:"Sechs", correct:false},{text:"Sieben", correct:true}]}
]},
	{ category:"Kurioses & R√§tselhaftes", questions:[
		{text:"Wie viele Herzen hat ein Oktopus?", answers:[{text:"1", correct:false},{text:"2", correct:false},{text:"3", correct:true},{text:"4", correct:false}]},
		{text:"Welches Tier schl√§ft am l√§ngsten im Jahr?", answers:[{text:"Katze", correct:false},{text:"Hund", correct:false},{text:"Fettfrosch", correct:true},{text:"Koala", correct:false}]},
		{text:"Wie nennt man die Angst vor langen W√∂rtern?", answers:[{text:"Arachnophobie", correct:false},{text:"Hippopotomonstrosesquippedaliophobie", correct:true},{text:"Xenophobie", correct:false},{text:"Klaustrophobie", correct:false}]},
		{text:"Welches Land hat die meisten Zeitzonen?", answers:[{text:"USA", correct:false},{text:"Kanada", correct:false},{text:"Frankreich", correct:true},{text:"Russland", correct:false}]},
		{text:"Welches chemische Element hat denselben Namen wie ein Planet?", answers:[{text:"Gold", correct:false},{text:"Platin", correct:false},{text:"Neon", correct:false},{text:"Uran", correct:true}]}
]}

];
questionCategories = questionCategories.sort(()=>Math.random()-0.5);

// Spieler beitreten
document.getElementById("joinBtn").addEventListener("click", async ()=>{
    const name=document.getElementById("playerName").value.trim();
    if(!name||name.length>10){ alert("Ung√ºltiger Name (max 10 Zeichen)!"); return; }
    if(!selectedTeam){ alert("Bitte Team w√§hlen!"); return; }
    const existing=await playersCol.where("name","==",name).get();
    if(!existing.empty){ alert("Name bereits vorhanden!"); return; }
    const gameDoc=await gameState.get();
    if(gameDoc.exists && gameDoc.data().started){ alert("Login w√§rend des laufende Spiels nicht m√∂glich!!!"); return; }
    const docRef=await playersCol.add({name,team:selectedTeam,score:0});
    currentPlayerId=docRef.id;
    document.getElementById("joinArea").style.display="none";
    document.getElementById("waitingArea").style.display="block";
    document.getElementById("waitingMessage").textContent="Bitte warte bis der Admin das Spiel startet...";
});

// GameState Listener
gameState.onSnapshot(doc=>{
    const data = doc.data();
    if(!data) return;

    // üîπ Nur starten, wenn Admin Spiel startet und Countdown noch nicht aktiv
    if(data.started && currentPlayerId && !data.countdownStarted){
        startCountdown(5);
        // üîπ Firestore-Flag setzen, damit andere Spieler nicht doppelt starten
        gameState.update({countdownStarted:true});
    }

    // Reset
	if(data.gameReset){
		document.getElementById("quizArea").style.display="none";
		document.getElementById("waitingArea").style.display="none";
		document.getElementById("joinArea").style.display="block";

		document.getElementById("playerName").value="";
		selectedTeam = null;
		score = 0;
		currentQuestionIndex = 0;
		currentQuestionSet = 0;
	
		// üîπ Fortschrittsz√§hler verstecken
		const progressEl = document.getElementById("progress");
		progressEl.textContent = "";
		progressEl.style.display = "none";
	
		if(currentPlayerId){
			playersCol.doc(currentPlayerId).delete();
			currentPlayerId=null;
		}
		gameState.update({gameReset:false});
	}
});

// Countdown Overlay
function startCountdown(sec){
    const overlay = document.getElementById("countdownOverlay");
    overlay.style.display = "flex";
    let c = sec;
    overlay.textContent = c;

    const int = setInterval(() => {
        c--;
        overlay.textContent = c > 0 ? c : "Start!";
        if(c < 0){
            clearInterval(int);
            overlay.style.display = "none";
            document.getElementById("waitingArea").style.display = "none";
            document.getElementById("quizArea").style.display = "block";

            // üîπ Fortschrittsz√§hler jetzt sichtbar machen
            const progressEl = document.getElementById("progress");
            progressEl.style.display = "block";

            // Erste Frage anzeigen
            showQuestion();
        }
    }, 1000);
}

// Frage anzeigen
function showQuestion(){
    clearInterval(questionTimer);
    const qSet = questionCategories[currentQuestionSet];
    const q = qSet.questions[currentQuestionIndex];

    const categoryEl = document.getElementById("categoryName");
	const pointsEl = document.getElementById("questionPoints");
    categoryEl.textContent = qSet.category;

    const colors = ["#03a9f4","#ff9800","#8bc34a","#e91e63","#9c27b0"];
    const color = colors[currentQuestionSet % colors.length];
    // stattdessen Hintergrund einf√§rben
	document.getElementById("questionHeader").style.background = color;
	categoryEl.style.color = "#fff"; // wei√üe Schrift f√ºr Kontrast
	pointsEl.style.color = "#fff"; // wei√üe Schrift f√ºr Kontrast


    if(currentQuestionIndex === 0) animateCategory(categoryEl,currentQuestionSet);

    document.getElementById("questionText").textContent = q.text;
    const currentPoints = currentQuestionIndex+1;
    document.getElementById("questionPoints").textContent = currentPoints + " Punkt" + (currentPoints>1?"e":"");

    const totalQuestions = questionCategories.reduce((sum, cat) => sum + cat.questions.length, 0);
    const currentGlobalIndex = questionCategories.slice(0,currentQuestionSet).reduce((sum,cat)=>sum+cat.questions.length,0) + currentQuestionIndex + 1;
    const progressEl = document.getElementById("progress");
    progressEl.textContent = currentGlobalIndex + " von " + totalQuestions;
    progressEl.style.fontWeight = "normal";

    const answersDiv = document.getElementById("answers");
    answersDiv.innerHTML = "";

    let timeLeft = questionDuration;
    const timerEl = document.getElementById("timer");
    timerEl.textContent = timeLeft;
    questionTimer = setInterval(()=>{
        timeLeft--;
        timerEl.textContent=timeLeft;
        if(timeLeft<=0){ clearInterval(questionTimer); autoNextQuestion(); }
    },1000);

    q.answers.forEach(a=>{
        const btn=document.createElement("button");
        btn.textContent=a.text;
        btn.className="answerBtn";
        btn.dataset.correct=a.correct;
        btn.onclick=()=>selectAnswer(btn,a.correct,currentPoints);
        answersDiv.appendChild(btn);
    });
}

// Kategorie animieren
function animateCategory(categoryEl,categoryIndex){
    const colors=["#03a9f4","#ff9800","#8bc34a","#e91e63","#9c27b0"];
    const color=colors[categoryIndex % colors.length];
    const questionHeader=document.getElementById("questionHeader");
    questionHeader.style.background=color;

    const overlay=document.createElement("div");
    overlay.textContent=categoryEl.textContent;
    overlay.style.position="fixed";
    overlay.style.top="50%";
    overlay.style.left="50%";
    overlay.style.transform="translate(-50%,-50%) scale(1.5)";
    overlay.style.padding="20px 40px";
    overlay.style.background=color;
    overlay.style.color="#fff";
    overlay.style.fontSize="2em";
    overlay.style.fontWeight="bold";
    overlay.style.borderRadius="8px";
    overlay.style.zIndex="2000";
    overlay.style.boxShadow="0 0 20px rgba(0,0,0,0.5)";
    overlay.style.textAlign="center";
    overlay.style.transition="transform 0.3s";
    document.body.appendChild(overlay);
    setTimeout(()=>{
        overlay.style.transform="translate(-50%,-50%) scale(1)";
        setTimeout(()=>{ overlay.remove(); categoryEl.style.border="none"; },3000);
    },10);
}

// Antworten und Punkteanimation
function selectAnswer(btn, correct, currentPoints){
    clearInterval(questionTimer);
    const buttons=document.querySelectorAll(".answerBtn");
    buttons.forEach(b=>{
        b.disabled=true;
        if(b.dataset.correct==="true") b.classList.add("correct");
    });
    if(correct){
        btn.classList.add("correct");
        score += currentPoints;
        animateScore(currentPoints);
        // üîπ Punkte direkt in Firestore speichern
        if(currentPlayerId){
            playersCol.doc(currentPlayerId).update({score});
        }
    } else btn.classList.add("wrong");
    setTimeout(autoNextQuestion,1000);
}

function autoNextQuestion(){
    currentQuestionIndex++;
    const qSet=questionCategories[currentQuestionSet];
    if(currentQuestionIndex>=qSet.questions.length){
        currentQuestionIndex=0;
        currentQuestionSet++;
        if(currentQuestionSet>=questionCategories.length){
            alert("Quiz zu Ende! Danke f√ºr's mitmachen.");
            return;
        }
    }
    showQuestion();
}

// Gesamtpunkteanimation
function animateScore(points){
    const scoreEl=document.getElementById("playerScore");
    scoreEl.textContent="Punkte: "+score;
    scoreEl.style.transition="transform 0.3s";
    scoreEl.style.transform="scale(1.3)";
    setTimeout(()=>scoreEl.style.transform="scale(1)",300);
    const plus=document.createElement("span");
    plus.textContent="+"+points;
    plus.style.position="absolute";
    plus.style.color="#28a745";
    plus.style.fontWeight="bold";
    plus.style.fontSize="1.2em";
    plus.style.top="-10px";
    plus.style.right="-20px";
    document.body.appendChild(plus);
    setTimeout(()=>plus.remove(),800);
}
</script>
</body>
</html>
