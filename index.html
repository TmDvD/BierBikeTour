<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Bierbike Quiz - Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family:sans-serif; background:#f4f4f4; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container { width:95%; max-width:500px; text-align:center; }
input, button { width:100%; padding:15px; font-size:1.2em; margin:10px 0; border-radius:10px; border:1px solid #ccc; box-sizing:border-box; }
button { background:#e0e0e0; color:#333; cursor:pointer; }
#loginArea, #quizArea { display:flex; flex-direction:column; align-items:center; }
#playerList { margin-top:20px; width:100%; }
.player { display:flex; justify-content:space-between; align-items:center; padding:0 10px; margin:5px 0; border-radius:6px; background:rgba(255,255,255,0.2); height:50px; }
.player .score { font-weight:bold; }
#timer { font-size:2em; margin:15px 0; font-weight:bold; transition: color 0.5s; }
.categoryBar { width:100%; display:flex; justify-content:space-between; align-items:center; padding:5px 10px; color:white; border-radius:5px; margin:10px 0; }
.categoryBar span.points { font-weight:bold; }
.questionBox { background:white; border-radius:10px; padding:15px; margin-bottom:15px; width:100%; }
.answer { background:#f0f0f0; padding:10px; border-radius:6px; margin:5px 0; cursor:pointer; }
.answer.correct { background:#c8e6c9; }
.answer.wrong { background:#f8d7da; }
.plusAnim { position:absolute; color:green; font-weight:bold; animation:moveUp 0.6s forwards; }
@keyframes moveUp { 0% { opacity:1; transform:translateY(0);} 100% { opacity:0; transform:translateY(-20px);} }
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container" id="loginArea">
  <h1>Bierbike Quiz</h1>
  <input type="text" id="playerName" placeholder="Name (max 10)" maxlength="10">
  <div style="display:flex; justify-content:center; gap:10px; margin-top:10px;">
    <button class="teamSelect" data-team="rot">Rot</button>
    <button class="teamSelect" data-team="blau">Blau</button>
  </div>
  <button id="joinBtn">Beitreten</button>
</div>

<div class="container" id="quizArea" style="display:none;">
  <div id="timer">0</div>
  <div id="categoryBar" class="categoryBar" style="background:green;">
    <span id="categoryName">Kategorie</span>
    <span class="points" id="questionPoints">0 P.</span>
  </div>
  <div class="questionBox" id="questionText">Frage erscheint hier</div>
  <div id="answers"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDS2CTzFC_G-dTi-LE5umuvTWET4plsGH0",
  authDomain: "as-fensterbau-baf6c.firebaseapp.com",
  projectId: "as-fensterbau-baf6c",
  storageBucket: "as-fensterbau-baf6c.firebasestorage.app",
  messagingSenderId: "25696521871",
  appId: "1:25696521871:web:35cca5b0e39f88c4576afa"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const playersCol = db.collection("players");
const gameState = db.collection("game").doc("state");

let playerName="", playerTeam="", playerScore=0;
let currentQ=0;
let questions=[
  {category:"Geografie", text:"Was Stadt ist die Hauptstadt von Frankreich?", answers:["Rom","Berlin","Paris","Madrid"], correct:2, points:1},
  {category:"Geografie", text:"Welches Land ist flächenmäßig das größte der Erde?", answers:["Kanada","Russland","USA","China"], correct:1, points:2},
  {category:"Geografie", text:"Welcher Fluss fließt durch Budapest?", answers:["Rhein","Elbe","Donau","Po"], correct:2, points:3},
  {category:"Geografie", text:"Welches Land hat keine Küste?", answers:["Bolivien","Peru","Kroatien","Thailand"], correct:0, points:4},
  {category:"Geografie", text:"In welchem Land liegt der höchste aktive Vulkan der Erde, der Ojos del Salado?", answers:["Chile","Indonesien","Italien","Äthiopien"], correct:0, points:5}
];

// Teamwahl Buttons
document.querySelectorAll(".teamSelect").forEach(btn=>{
  btn.addEventListener("click", e=>{
    playerTeam=e.target.dataset.team;
    document.querySelectorAll(".teamSelect").forEach(b=>b.style.opacity=b.dataset.team===playerTeam?"1":"0.5");
    document.querySelectorAll(".teamSelect").forEach(b=>b.style.border=b.dataset.team===playerTeam?"2px solid #333":"none");
  });
});

document.getElementById("joinBtn").addEventListener("click", async ()=>{
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName || playerName.length>10){alert("Name max. 10 Zeichen"); return;}
  if(!playerTeam){alert("Team wählen!"); return;}
  
  // Prüfen auf Duplikate
  const snap=await playersCol.where("name","==",playerName).get();
  if(!snap.empty){alert("Name bereits vergeben"); return;}
  
  await playersCol.doc(playerName).set({name:playerName,team:playerTeam,score:0});
  document.getElementById("loginArea").style.display="none";
  document.getElementById("quizArea").style.display="flex";
  listenGameStart();
});

// Spieler-Score live
playersCol.doc(playerName).onSnapshot(doc=>{
  if(!doc.exists) return;
  playerScore=doc.data().score||0;
});

// Quizstart
function listenGameStart(){
  gameState.onSnapshot(doc=>{
    const data=doc.data();
    if(data && data.started){
      startCountdown();
    }
  });
}

// Countdown vor Spiel
function startCountdown(){
  let sec=5;
  const timerEl=document.getElementById("timer");
  const colors=["darkgreen","lightgreen","yellow","orange","red"];
  timerEl.innerText=sec;
  let int=setInterval(()=>{
    sec--;
    if(sec<0){ clearInterval(int); showQuestion(); return; }
    timerEl.innerText=sec;
    timerEl.style.color=colors[5-sec>=colors.length?colors.length-1:5-sec];
  },1000);
}

// Frage anzeigen
function showQuestion(){
  if(currentQ>=questions.length){document.getElementById("timer").innerText="Feierabend!"; return;}
  const q=questions[currentQ];
  document.getElementById("categoryName").innerText=q.category;
  document.getElementById("questionText").innerText=q.text;
  document.getElementById("questionPoints").innerText=q.points + (q.points>1?" P.":" P.");
  const answersDiv=document.getElementById("answers");
  answersDiv.innerHTML="";
  q.answers.forEach((a,i)=>{
    const btn=document.createElement("div");
    btn.className="answer";
    btn.innerText=a;
    btn.addEventListener("click",()=>{
      if(i===q.correct){
        addPoints(q.points);
        btn.classList.add("correct");
      } else { btn.classList.add("wrong"); }
      setTimeout(()=>{ currentQ++; showQuestion(); },1500);
    });
    answersDiv.appendChild(btn);
  });
}

// Punkte Animation
function addPoints(p){
  const playerRef=playersCol.doc(playerName);
  playerScore+=p;
  playerRef.update({score:playerScore});
  const timerEl=document.getElementById("timer");
  const plus=document.createElement("span");
  plus.className="plusAnim";
  plus.innerText="+"+p;
  plus.style.position="absolute";
  plus.style.left=(timerEl.offsetLeft+50)+"px";
  plus.style.top=(timerEl.offsetTop-20)+"px";
  document.body.appendChild(plus);
  setTimeout(()=>{document.body.removeChild(plus);},600);
}
</script>
</body>
</html>
